{%- comment -%}
  version: 0.0.4
  ----------------------------------------------------------------------------------
   Plug in Speed for Shopify

   Copyright (c) 2017 Pemberton Rank Ltd, a company registered in England 7341337

   This file is subject to the license at https://www.pluginspeed.com/eula
  ----------------------------------------------------------------------------------

   You can disable HTML minification through your entire shop by changing
	useMinification to false below
{%- endcomment -%}

{%- assign useMinification = true -%}

{%- assign profile = false -%}
{%- assign endings = "all" -%}
{%- assign startings = false -%}
{%- assign comments = "all" -%}
{%- assign blanklines = true -%}
{%- assign clippings = true  -%}

{%- comment -%}Copyright (c) 2014 Anatol Broder{%- endcomment -%}
{%- comment -%}Initialization{%- endcomment -%}

{%- assign _LINE_FEED = "
" -%}

{%- unless useMinification -%}
{{ minified }}
{%- else -%}

{%- capture _content -%}{{ minified }}{%- endcapture -%}
{%- assign _profile = profile -%}

{%- comment -%}Remove end tags{%- endcomment -%}

{%- if endings == "all" -%}
  {%- assign _endings = "html head body li dt dd rt rp optgroup option colgroup caption thead tbody tfoot tr td th" | split: " " -%}
{%- else -%}
  {%- assign _endings = endings -%}
{%- endif -%}
{%- for _element in _endings -%}
  {%- capture _end -%}</{{ _element }}>{%- endcapture -%}
  {%- assign _content = _content | remove: _end -%}
{%- endfor -%}
{%- if _profile and _endings -%}
  {%- assign _profile_endings = _content | size | plus: 1 -%}
{%- endif -%}

{%- comment -%}Remove blanklines{%- endcomment -%}
{%- for i in (2..20) reversed -%}
  {%- assign spaces = _LINE_FEED -%}
  {%- for j in (1..i) -%}
    {%- assign spaces = spaces | append: " " -%}
  {%- endfor -%}

  {%- assign _content = _content | replace: spaces, "
" -%}
{%- endfor -%}

{%- for i in (2..15) reversed -%}
  {%- assign breaks = "
" -%}
  {%- for j in (1..i) %}
    {%- assign breaks = breaks | append: "
" -%}
  {%- endfor -%}

  {%- assign _content = _content | remove: breaks -%}
{%- endfor -%}

{%- assign _content = _content | replace: "

" , "
" -%}

{%- assign _content = _content | replace: "
<" , "<" -%}

{%- assign _content = _content | replace: "
<" , "<" -%}

{%- assign _content = _content | replace: ">
" , ">" -%}

{%- for i in (1..6) reversed -%}
  {%- assign spaces = ">" -%}
  {%- for j in (1..i) -%}
    {%- assign spaces = spaces | append: " " -%}
  {%- endfor -%}
  {%- assign spaces = spaces | append: "<" -%}

  {%- assign _content = _content | replace: spaces, "><" -%}
{%- endfor -%}

{%- if _profile -%}
  {%- assign _profile_collapse = _content | size | plus: 1 -%}
{%- endif -%}


{%- comment -%}Output{%- endcomment -%}

{{ _content }}

{%- if _profile -%}
  <table id="compress_html_profile_{{ site.time | date: "%Y%m%d" }}" class="compress_html_profile">
    <thead>
    <tr> <td>Step <td>Bytes
    <tbody>
    <tr> <td>raw <td>{{ content | size }}
  {%- if _profile_endings -%}
    <tr> <td>endings <td>{{ _profile_endings }}
  {%- endif -%}
  {%- if _profile_startings -%}
    <tr> <td>startings <td>{{ _profile_startings }}
  {%- endif -%}
  {%- if _profile_comments -%}
    <tr> <td>comments <td>{{ _profile_comments }}
  {%- endif -%}
  {%- if _profile_collapse -%}
    <tr> <td>collapse <td>{{ _profile_collapse }}
  {%- endif -%}
  {%- if _profile_clippings -%}
    <tr> <td>clippings <td>{{ _profile_clippings }}
  {%- endif -%}
  </table>
{%- endif -%}

{%- endunless -%}
